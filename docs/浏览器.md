# 浏览器

## 强缓存和协商缓存

http 缓存响应头： Expires, Cache-Control, Last-Modified, Etag

### 强缓存（过期时间）

浏览器不会像服务器发送任何请求，直接从本地缓存中读取文件并返回

**Cache-Control**（优先级更高）：当值设为 max-age=300 时，则代表在这个请求正确返回时间的 5 分钟内再次加载资源，就会命中强缓存。

**Expires**：过期时间，如果设置了时间，则浏览器会在设置的时间内直接读取缓存，不再请求

Ctrl+F5 强制刷新无效

### 协商缓存（修改时间）

当资源过期时，向服务器发送请求，服务器根据请求头参数来判断是否命中协商缓存，如果命中，则返回 304 状态码并告诉浏览器从缓存中读取资源，否则返回 200 状态码和新资源。

- 协商缓存标识 1，加上时间戳的 hash 值：etag/if-none-match

当资源过期时，浏览器发现响应头里有 Etag,则再次像服务器请求时带上请求头 if-none-match(值是 Etag 的值)。服务器收到请求进行比对，决定返回新页面 200 或 304

- 标识 2，最新修改时间：Last-modified/if-modify-since

当资源过期时（浏览器判断 Cache-Control 标识的 max-age 过期），发现响应头具有 Last-Modified 声明，则再次向服务器请求时带上头 if-modified-since，表示请求时间。服务器收到请求后发现有 if-modified-since 则与被请求资源的最后修改时间进行对比（Last-Modified）,若最后修改时间较新（大），说明资源又被改过，则返回最新资源，HTTP 200 OK;若最后修改时间较旧（小），说明资源无新修改，响应 HTTP 304 走缓存。
